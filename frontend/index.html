<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Speaking Avatar ‚Äî MVP</title>

  <!-- Optional: Kid-friendly Google Fonts (recommended) -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Fredoka+One&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <!-- Link to your stylesheet -->
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="frame">

    <!-- LEFT: Avatar / Canvas -->
    <div class="panel left" role="main" aria-label="Avatar area and controls">
      <h1>Speaking Avatar ‚Äî MVP</h1>

      <!-- Avatar / Three.js canvas container -->
      <div id="canvas-container" aria-label="3D avatar area" class="panel avatar-box">
        <!-- Scroll-safe wrapper receives touch gestures; canvas will be appended here by threejs-avatar.js -->
        <div id="avatar-scroll-safe" class="avatar-scroll-safe" aria-hidden="false"></div>

        <!-- rotate handle (above wrapper so it's clickable) -->
        <div class="avatar-rotate-handle" title="Drag to rotate avatar" aria-hidden="false">‚Üª</div>
      </div>

      <!-- Controls row -->
      <div class="controls" role="toolbar" aria-label="Voice controls">
        <button id="micBtn" title="Start or stop listening">üé§ Start Listening</button>

        <!-- Pause / resume / stop for TTS -->
        <button id="pauseTtsBtn" class="secondary" title="Pause reading">‚è∏ Pause TTS</button>
        <button id="resumeTtsBtn" class="secondary" style="display:none" title="Resume reading">‚ñ∂ Resume TTS</button>
        <button id="stopTtsBtn" class="secondary" title="Stop reading">‚èπ Stop TTS</button>

        <!-- Quick test -->
        <button id="testBtn" class="secondary" title="Send a test message">üß™ Test Chat</button>

        <div id="status" class="meta" role="status" aria-live="polite" style="margin-left:10px">Idle</div>
      </div>

      <footer class="small" aria-hidden="false">
        Mic uses Web Speech API. Audio uses browser TTS (speechSynthesis). Avatar uses Three.js GLB model from <code>/assets/avatar.glb</code>.
      </footer>
    </div>

    <!-- RIGHT: Conversation / Mode / Quick selects -->
    <div class="panel right" role="complementary" aria-label="Conversation and settings">

      <h1>Conversation</h1>

      <!-- Optional typed chat input (press Send or wire Enter -> askBackend in JS) -->
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <input id="chatInput" type="text" placeholder="Type a question for Spidey Teacher..." aria-label="Type your question" style="flex:1;padding:12px;border-radius:16px;border:2px solid #e0e0e0;font-size:15px">
        <button id="sendBtn" class="secondary" title="Send typed question">Send</button>
      </div>
      <!-- Note: To make the typed input actually send to the backend, add a small JS snippet that calls your
           askBackend(chatInput.value) function. Because app.js is an ES module, wire send handling inside that module. -->

      <!-- SCROLLABLE AREA (conversation history) -->
      <div id="conversationScroll" class="scroll-area" role="region" aria-label="Conversation history">
        <!-- Top small transcript area (shows what user said or typed briefly) -->
        <div id="transcript" class="bubble user" style="display:none" aria-hidden="true"></div>

        <!-- AI reply area (rendered markdown) -->
        <div id="reply" class="bubble" role="article" aria-live="polite"></div>
      </div>
      <!-- /SCROLLABLE AREA -->

      <!-- Quick class selector buttons -->
      <div style="margin-top:6px">
        <div class="small" style="margin-bottom:8px"><strong>Quick Class</strong></div>
        <div id="classButtons" style="display:flex;gap:8px;flex-wrap:wrap" role="group" aria-label="Quick class select">
          <button class="class-btn secondary" data-class="class3" aria-pressed="false">Class 3</button>
          <button class="class-btn secondary" data-class="class7" aria-pressed="false">Class 7</button>
          <button class="class-btn secondary" data-class="class10" aria-pressed="false">Class 10</button>
        </div>
      </div>

      <!-- Quick subject selector buttons -->
      <div style="margin-top:8px">
        <div class="small" style="margin-bottom:8px"><strong>Quick Subject</strong></div>
        <div id="subjectButtons" style="display:flex;gap:8px;flex-wrap:wrap" role="group" aria-label="Quick subject select">
          <button class="subject-btn secondary" data-sub="general" aria-pressed="false">General</button>
          <button class="subject-btn secondary" data-sub="math" aria-pressed="false">Math</button>
          <button class="subject-btn secondary" data-sub="english" aria-pressed="false">English</button>
          <button class="subject-btn secondary" data-sub="evs" aria-pressed="false">EVS</button>
          <button class="subject-btn secondary" data-sub="gk" aria-pressed="false">GK</button>
        </div>
      </div>

      <!-- Mode & Subject selects (these drive prompts) -->
      <div style="margin-top:12px">
        <div class="small" style="margin-bottom:6px"><strong>Mode</strong></div>
        <select id="schoolMode" class="small" aria-label="Choose class / mode">
          <option value="general">General (Default)</option>
          <option value="class3">Class 3 (8 yrs)</option>
          <option value="class7">Class 7 (13 yrs)</option>
          <option value="class10">Class 10 (15 yrs)</option>
        </select>
      </div>

      <div style="margin-top:12px">
        <div class="small" style="margin-bottom:6px"><strong>Subject</strong></div>
        <select id="subject" class="small" aria-label="Choose subject">
          <option value="general">General</option>
          <option value="math">Mathematics</option>
          <option value="english">English</option>
          <option value="evs">EVS</option>
          <option value="gk">General Knowledge</option>
        </select>
      </div>

      <!-- Clear + Demo buttons -->
      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="clearBtn" class="secondary" style="flex:1">Clear</button>
        <button id="demoLessonBtn" class="secondary" style="flex:1">Load Demo Lesson</button>
      </div>

      <!-- Status / log -->
      <div style="margin-top:12px" class="small" aria-live="polite">
        <strong>Status</strong>
        <div id="log" style="margin-top:8px;color:var(--muted);min-height:60px;font-size:13px"></div>
      </div>
    </div>
  </div>

  <!-- Markdown + sanitizer (CDN) - MUST load before your app bundle -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>

  <!-- App scripts (ES module) -->
  <script type="module" src="/src/app.js"></script>

  <!--
    Optional: If you want the typed input to work immediately without editing app.js,
    add this snippet inside an ES module that imports askBackend from your module.
    Because askBackend is defined inside /src/app.js (not exported), it's safer to
    wire this inside your app.js:

    // inside /src/app.js (near the end)
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.addEventListener('click', async () => {
      const v = chatInput.value.trim();
      if (v) { await askBackend(v); chatInput.value = ''; }
    });
    chatInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') { sendBtn.click(); }
    });
  -->
</body>
</html>
